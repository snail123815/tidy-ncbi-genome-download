import argparse
import os

from tools import getInfoFrom, getExclusion, filterDownloads, gatherAssemblies

def processArgs():
    parser = argparse.ArgumentParser()
    parser.add_argument('tsv', help="Path to the .tsv file generated by `-m` switch")
    parser.add_argument('dir', help="Path to the directory generated by `-o` parameter")
    parser.add_argument('--excludeList', help="Exclusion list file, one item per line",
                        default="")
    parser.add_argument('--maxCtg', type=int,
                        help="Maximum number of contigs that a genome will be kept.",
                        default=None)
    parser.add_argument('--targetDir', type=str,
                        help='Valid assemblies will be copied to this directory.',
                        default=None)
    args = parser.parse_args()
    return args


def main():
    args = processArgs()
    strains = getInfoFrom(args)
    exclusions = getExclusion(args.excludeList)
    validAssemblies, excludedAccs, skippedAccs, tooManyContigs = \
        filterDownloads(strains, exclusions, args.maxCtg)

    if args.targetDir is None:
        targetDir = os.path.realpath(args.dir) + "-ready"
    else: targetDir =  args.targetDir
    gatherAssemblies(validAssemblies, targetDir)


if __name__ == "__main__":
    main()